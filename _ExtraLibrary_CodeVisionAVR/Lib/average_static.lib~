// GitHub Account:  GitHub.com/AliRezaJoodi

#include <average_static.h>

//***********************************
uint16_t Average_BlockUpdate_uint16(uint16_t value){
    static uint16_t sum=0;
    static uint16_t average=0;
    static uint8_t i=0;
    
    sum = sum + value;
    ++i; 
    
    if( (i==AVERAGE_COUNT) || (i==64) ){
        average = sum / i;
        sum=0;
        i=0;
    }
    
    return average;  
}

// Average Block Update
//***********************************
float Average_BlockUpdate_float(float value){
    static float sum=0;
    static float average=0;
    static unsigned char i=0;
    
    sum = sum + value;
    ++i; 
    
    if(i>=AVERAGE_COUNT){
        average=sum/AVERAGE_COUNT;
        sum=0;
        i=0;
    } 
    
    return average;  
}
 
// Moving Average Method with Sliding Window (Shift-based)   
//***********************************
float Average_MovingWithShift_float(float value){
    static float d[AVERAGE_COUNT];
    float average=0;
    unsigned char i=0; 
    
    for (i=1; i<AVERAGE_COUNT; ++i){
        d[i-1]=d[i];    
    }
    d[AVERAGE_COUNT-1]=value;
    
    for(i=0; i<AVERAGE_COUNT; ++i){
        average=average+d[i];
    } 
    average=average/AVERAGE_COUNT;
    
    return average;
}

// Moving Average Method with Circular Buffer
//***********************************
float Average_MovingWithCircularBuffer_float(float value){
    static float buf[AVERAGE_COUNT];
    static uint8_t i = 0;
    static uint8_t count = 0;
    static float sum = 0;

    sum = sum - buf[i];
    buf[i] = value;
    sum = sum + value;

    i++; if(i >= AVERAGE_COUNT) i = 0;
    if(count < AVERAGE_COUNT) count++;

    return (sum / count);
}

