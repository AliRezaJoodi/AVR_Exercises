// GitHub Account: GitHub.com/AliRezaJoodi

#include <display7segment4digit2display_driver.h>

//**************************************
void Display7Segment4Digit2Disply_Config(void){        
    D1_0_DDR=1; D1_0_PORT=!ACTIVATE_DIGIT;
    D1_1_DDR=1; D1_1_PORT=!ACTIVATE_DIGIT;
    D1_2_DDR=1; D1_2_PORT=!ACTIVATE_DIGIT;
    D1_3_DDR=1; D1_3_PORT=!ACTIVATE_DIGIT; 
    D2_0_DDR=1; D2_0_PORT=!ACTIVATE_DIGIT;
    D2_1_DDR=1; D2_1_PORT=!ACTIVATE_DIGIT;
    D2_2_DDR=1; D2_2_PORT=!ACTIVATE_DIGIT;
    D2_3_DDR=1; D2_3_PORT=!ACTIVATE_DIGIT;
    
    A_DDR=1; A_PORT=!ACTIVATE_SEGMENT;
    B_DDR=1; B_PORT=!ACTIVATE_SEGMENT;
    C_DDR=1; C_PORT=!ACTIVATE_SEGMENT;
    D_DDR=1; D_PORT=!ACTIVATE_SEGMENT; 
    E_DDR=1; E_PORT=!ACTIVATE_SEGMENT;
    F_DDR=1; F_PORT=!ACTIVATE_SEGMENT;
    G_DDR=1; G_PORT=!ACTIVATE_SEGMENT;
    DP_DDR=1; DP_PORT=!ACTIVATE_SEGMENT;
}

//**************************************
void Display7Segment4Digit2Disply_TurnOffDigits(void){
    D1_0=!ACTIVATE_DIGIT; 
    D1_1=!ACTIVATE_DIGIT; 
    D1_2=!ACTIVATE_DIGIT; 
    D1_3=!ACTIVATE_DIGIT; 
    D2_0=!ACTIVATE_DIGIT; 
    D2_1=!ACTIVATE_DIGIT; 
    D2_2=!ACTIVATE_DIGIT; 
    D2_3=!ACTIVATE_DIGIT;  
}

//**************************************
void Display7Segment4Digit2Disply_DriveSegments(unsigned char digit){
    #ifndef CHKBIT(ADDRESS,BIT)
        #define CHKBIT(ADDRESS,BIT)  ((ADDRESS &(1<<BIT))>>BIT) 
    #endif 
    
    A_SEGMENT = CHKBIT(digit,0);
    B_SEGMENT = CHKBIT(digit,1);
    C_SEGMENT = CHKBIT(digit,2);
    D_SEGMENT = CHKBIT(digit,3);
    E_SEGMENT = CHKBIT(digit,4);
    F_SEGMENT = CHKBIT(digit,5);
    G_SEGMENT = CHKBIT(digit,6);
    DP_SEGMENT = CHKBIT(digit,7);       
}

//**************************************
char Display7Segment4Digit2Disply_DriveDisplay1(uint8_t segments[]){
    static char i=0;

    Display7Segment4Digit2Disply_TurnOffDigits();
    
    switch(i){
        case 0:
            Display7Segment4Digit2Disply_DriveSegments( segments[i] );
            D1_0=ACTIVATE_DIGIT;
            ++i;
            break; 
        case 1:
            Display7Segment4Digit2Disply_DriveSegments( segments[i] );
            D1_1=ACTIVATE_DIGIT;
            ++i;
            break;  
        case 2:
            Display7Segment4Digit2Disply_DriveSegments( segments[i] );
            D1_2=ACTIVATE_DIGIT;
            ++i;
            break; 
        case 3:
            Display7Segment4Digit2Disply_DriveSegments( segments[i] );
            D1_3=ACTIVATE_DIGIT;
            i=0;   
            break;
    } 
    
    return i;
}

//**************************************
char Display7Segment4Digit2Disply_DriveDisplay2(uint8_t segments[]){
    static char i=0;

    Display7Segment4Digit2Disply_TurnOffDigits();
    
    switch(i){
        case 0:
            Display7Segment4Digit2Disply_DriveSegments( segments[i] );
            D2_0=ACTIVATE_DIGIT;
            ++i;
            break; 
        case 1:
            Display7Segment4Digit2Disply_DriveSegments( segments[i] );
            D2_1=ACTIVATE_DIGIT;
            ++i;
            break;  
        case 2:
            Display7Segment4Digit2Disply_DriveSegments( segments[i] );
            D2_2=ACTIVATE_DIGIT;
            ++i;
            break; 
        case 3:
            Display7Segment4Digit2Disply_DriveSegments( segments[i] );
            D2_3=ACTIVATE_DIGIT;
            i=0;   
            break;
    } 
    
    return i;
}
