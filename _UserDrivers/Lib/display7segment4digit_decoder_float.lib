// GitHub Account: GitHub.com/AliRezaJoodi

#include <display7segment4digit_decoder_float.h>

//*************************************************
void Display7Segment4Digit_Toggle4Byte(uint8_t *seg){
 uint8_t i = 0;

 for(i=0; i<4; ++i){
    *(seg + i) = ~(*(seg + i));
 }
}

//*************************************************
uint8_t Display7Segment4Digit_CheckFloatForInvalid(float value){
    if (value<0 || 10000<value ){
        return 1;   //Error
    }

    return 0;
}

//*************************************************
uint8_t Display7Segment4Digit_DecodeFloat_2d(float value, uint8_t *seg){
    uint16_t value_u16 = 0;
    uint8_t digit = 0;
    uint8_t dp = 2;

    if( Display7Segment4Digit_CheckFloatForInvalid(value) ){
        for (digit=0; digit<4; ++digit){
            *(seg + digit) = 0b01000000;
        }
        return 1; // Error
    }

    if (value<100){
        value_u16 = value*100;
        dp = 2;
    }
    else if (value<1000) {
        value_u16 = value*10;
        dp = 1;
    }
    else if (value<10000) {
        value_u16 = value;
        dp = 0;
    }

    digit=value_u16%10;
    Seg7_1Digit_EncodeDigit_ByRef(digit, (seg+3));

    value_u16=value_u16/10;
    digit=value_u16%10;
    Seg7_1Digit_EncodeDigit_ByRef(digit, (seg+2));
    if(dp==1){
        *(seg+2) = (*(seg+2)) | 0b10000000;
    }

    value_u16=value_u16/10;
    digit=value_u16%10;
    Seg7_1Digit_EncodeDigit_ByRef(digit, (seg+1));
    if(dp==2){
        *(seg+1) = (*(seg+1)) | 0b10000000;
    }

    value_u16=value_u16/10;
    digit=value_u16%10;
    Seg7_1Digit_EncodeDigit_ByRef(digit, (seg+0));

    if(*(seg+0) == 0b00111111){
        *(seg+0) = 0b00000000;
    }

    return 0;
}

//*************************************************
uint8_t Display7Segment4Digit_DecodeFloat_1d(float value, uint8_t *seg){
    uint16_t value_u16 = 0;
    uint8_t digit = 0;
    uint8_t dp = 1;

    if( Display7Segment4Digit_CheckFloatForInvalid(value) ){
        for (digit=0; digit<4; ++digit){
            *(seg + digit) = 0b01000000;
        }
        return 1;
    }

    if (value<1000) {
        value_u16 = value*10;
        dp = 1;
    }
    else if (value<10000) {
        value_u16 = value;
        dp = 0;
    }

    digit=value_u16%10;
    Seg7_1Digit_EncodeDigit_ByRef(digit, (seg+3));

    value_u16=value_u16/10;
    digit=value_u16%10;
    Seg7_1Digit_EncodeDigit_ByRef(digit, (seg+2));
    if(dp==1){
        *(seg+2) = (*(seg+2)) | 0b10000000;
    }

    value_u16=value_u16/10;
    digit=value_u16%10;
    Seg7_1Digit_EncodeDigit_ByRef(digit, (seg+1));

    value_u16=value_u16/10;
    digit=value_u16%10;
    Seg7_1Digit_EncodeDigit_ByRef(digit, (seg+0));


    if(*(seg+0) == 0b00111111){
        *(seg+0) = 0b00000000;

        if(*(seg+1) == 0b00111111){
            *(seg+1) = 0b00000000;
        }
    }

    return 0;
}
